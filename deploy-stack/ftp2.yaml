version: "3"

services:
  ftp:
    image: stilliard/pure-ftpd
    volumes:
      - "ftp_www:/home"
    ports:
      - "21:21"
      - "30000-30009:30000-30009"
    environment:
      PUBLICHOST: ${host}
      FTP_USER_NAME: ${user}
      FTP_USER_PASS: ${pass}
      FTP_USER_HOME: /home
      FTP_USER_UID: 82
      FTP_USER_GID: 82
      FTP_USER_HOME_PERMISSION: 755
    deploy: 
      replicas: 1
      restart_policy:
        condition: on-failure
      placement:
        constraints: [node.role == manager]

volumes:
  ftp_www:
    driver: local
    driver_opts:
      type: nfs
      o: addr=${nfs},vers=4,soft,rw
      device: ":/volumes/web"